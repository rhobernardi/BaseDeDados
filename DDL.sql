DROP TABLE CONSULTA;
DROP TABLE DIAGNOSTICO;
DROP TABLE ATLETA;
DROP TABLE MEDICO;

CREATE TABLE DIAGNOSTICO(
    id INTEGER NOT NULL,
    descricao VARCHAR2(30) NOT NULL,
    
    CONSTRAINT pk_diagnostico PRIMARY KEY(id)
);

CREATE TABLE ATLETA(
    nro_passaporte  VARCHAR2(12)     NOT NULL,
    peso            NUMBER(3)      NOT NULL,
    altura          NUMBER(3)      NOT NULL,
    
    CONSTRAINT pk_atleta PRIMARY KEY (nro_passaporte)
);

CREATE TABLE MEDICO(
    nome VARCHAR2(30) NOT NULL,
    CRM NUMBER(8) NOT NULL,
    doc_identidade NUMBER(9) NOT NULL,
    endereco VARCHAR2(30) NOT NULL,
    
    CONSTRAINT pk_medico PRIMARY KEY (CRM)
);

CREATE TABLE CONSULTA(
    medico NUMBER(8) NOT NULL,
    paciente VARCHAR2(12) NOT NULL,
    data_consulta DATE NOT NULL,
    diagnostico INTEGER NOT NULL,
    
    CONSTRAINT pk_consulta PRIMARY KEY (medico, paciente, data_consulta),
    CONSTRAINT fk1_consulta FOREIGN KEY (medico)
        REFERENCES MEDICO(CRM)
        ON DELETE CASCADE,
    CONSTRAINT fk2_consulta FOREIGN KEY (diagnostico)
        REFERENCES DIAGNOSTICO(id)
        ON DELETE CASCADE,
    CONSTRAINT fk3_consulta FOREIGN KEY (diagnostico)
        REFERENCES DIAGNOSTICO(id)
        ON DELETE CASCADE
);

INSERT INTO DIAGNOSTICO VALUES (1,'braco quebrado');
INSERT INTO DIAGNOSTICO VALUES (2,'cabeca rachada');
INSERT INTO DIAGNOSTICO VALUES (3,'inutilizado');

INSERT INTO ATLETA VALUES ('123456789ABC', 65, 182);
INSERT INTO ATLETA VALUES ('CBA987654321', 80, 164);
INSERT INTO ATLETA VALUES ('3412ABC56789', 76, 198);

INSERT INTO MEDICO VALUES ('Alberto', 12345678, 987654321, 'Rua A');
INSERT INTO MEDICO VALUES ('Mauricio', 87654321, 284619375, 'Rua B');
INSERT INTO MEDICO VALUES ('Rodrigo', 54637281, 937275812, 'Rua C');

INSERT INTO CONSULTA VALUES (12345678, 'CBA987654321', '30-AUG-2017', 2);
INSERT INTO CONSULTA VALUES (54637281, '3412ABC56789', '19-FEV-2017', 1);
INSERT INTO CONSULTA VALUES (87654321, '123456789ABC', '12-NOV-2017', 2);
INSERT INTO CONSULTA VALUES (54637281, 'CBA987654321', '19-MAI-2017', 2);
INSERT INTO CONSULTA VALUES (12345678, '3412ABC56789', '19-AUG-2017', 3);
INSERT INTO CONSULTA VALUES (12345678, '123456789ABC', '24-JUL-2017', 1);


COMMIT;